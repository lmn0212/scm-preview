<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/style.css?version=e84c845">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
</head>
<body>
<section class="main-container" style="background: url('media/food.png') repeat; background-size: contain;">
    <div class="envelope-front">
        <div class="image" style="background: url('media/card-envelope-visite_2x.jpg') repeat; background-size: cover;">
            <p>Дорогому другу</p>
        </div>
    </div>
    <div class="envelope-back">
        <div class="backwall-env" style="background: url('media/card-envelope-under.png') no-repeat; background-size: contain;"></div>
        <div class="inner-back"></div>
        <div id="card">
            <div class="card-back" style="background: url('media/GHBMenBabochkaRubashkaOborot.jpg') no-repeat; background-size: contain;"></div>
            <div class="card-front" style="background: url('media/GHBMenBabochkaRubashkaLitso.jpg') no-repeat; background-size: contain;"></div>
        </div>
        <div class="cover-back" style="background: url('media/card-envelope-over.png') no-repeat; background-size: contain;"></div>
        <div class="cover-top" style="background: url('media/card-envelope-under_.png') no-repeat; background-size: contain;"></div>
    </div>
</section>
</body>
</html>
<script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>

<script type="text/javascript">
    const $screenWidth = $(window).width();
    $( document ).ready(function() {
        $('.envelope-front').animate({ rotateAngle: 90 }, {
            step: function(now,fx) {
                $(this).css('-webkit-transform','rotateY('+now+'deg)');
                $(this).css('-moz-transform','rotateY('+now+'deg)');
                $(this).css('transform','rotateY('+now+'deg)');
            },
            duration:1500,
            easing: 'linear',
            complete:  backenvelope
        });
    });
    function backenvelope() {
        $('.envelope-front').animate({opacity: 0});
        var $elem = $('.envelope-back');
        $elem.animate({opacity: 1});
        $({deg: -90}).animate({deg: 0}, {
            duration: 1500,
            step: function(now) {
                $elem.css({
                    transform: 'rotateY(' + now + 'deg)'
                });
            },
            easing: 'linear',
            complete:  setTimeout(rotateEnv, 2000)
        });
    }
    function rotateEnv() {
        let $rightOffset;
        if ($screenWidth < 1600 && $screenWidth > 1200) {
            $rightOffset = '30%'
        } else if ($screenWidth < 1200) {
            $rightOffset = '23%'
        } else {
            $rightOffset = '36%'
        }
        $('.envelope-back').animate({ right: $rightOffset, rotateAngle: 90 }, {
            step: function(now,fx) {
                $(this).css('-webkit-transform','rotate('+now+'deg)');
                $(this).css('-moz-transform','rotate('+now+'deg)');
                $(this).css('transform','rotate('+now+'deg)');
            },
            duration:1500,
            easing: 'linear',
            complete:  setTimeout(openEnv, 1000)
        });
    }
    function openEnv() {
        // $('.cover-top').animate({rotateAngle: -180 }, {
        //     step: function(now,fx) {
        //         $(this).css({'-webkit-transform': 'rotateX('+now+'deg)','transform-origin': 'top'});
        //         $(this).css({'-moz-transform':'rotateX('+now+'deg)','transform-origin': 'top'});
        //         $(this).css({'transform':'rotateX('+now+'deg)','transform-origin': 'top'});
        //     },
        //     duration: 1500,
        //     easing: 'linear'
        // });
        $('.cover-top').animate({opacity: 0}, 200, 'linear', backwallAppear );

    }

    function backwallAppear() {
        $('.backwall-env').animate({opacity: 1}, 200, cardMove );
    }
    function cardMove() {
        let card = $('#card');
        card.animate({top:'-480px'}, 1500);
        setTimeout(function () {
            card.css('z-index', '1');
        }, 1500);
        card.animate({top:'-40px', left:'180px'}, 1500, cardFlip);
    }
    function cardFlip() {
        $('#card').animate({ rotateAngle: 180 }, {
            step: function(now,fx) {
                $(this).css('-webkit-transform','rotateX('+now+'deg) rotate(-90deg)');
                $(this).css('-moz-transform','rotateX('+now+'deg) rotate(-90deg)');
                $(this).css('transform','rotateX('+now+'deg) rotate(-90deg)');
            },
            duration:1500,
            easing: 'linear',
            complete:  setTimeout(cardBackFlip, 2000)
        });
    }
    function cardBackFlip() {
        $('#card').animate({ rotateAngle: 0 }, {
            step: function(now,fx) {
                $(this).css('-webkit-transform','rotateX('+now+'deg) rotate(-90deg)');
                $(this).css('-moz-transform','rotateX('+now+'deg) rotate(-90deg)');
                $(this).css('transform','rotateX('+now+'deg) rotate(-90deg)');
            },
            duration:1500,
            easing: 'linear'
        });
    }
</script>